<!DOCTYPE html>
<html>
    <head>
        <title>Ping Pone Trackone</title>
    </head>
    <body>
		<div align="center">
			<font face="verdana"><h1 id="speedId">Ping Pone Trackone</h1></font>
			<canvas id="pingPongCanvas" width="640" height="480" style="border:1px solid #000000;">
		</div>

		
        <script>

			var savedX, savedY = 0;
			var dimensionX = 640;
			var dimensionY = 480;
			
			var dimenstionTableY = 300;
			var realDimensionTableY = 100;
			var intervalInMs = 250;
			var dimenstionTableX = dimenstionTableY*1.8;
			
            var ws = new WebSocket("ws://127.0.0.1:5678/");
			
            ws.onmessage = function (event) {
				console.log(event.data);

				var c = document.getElementById("pingPongCanvas");
				var ctx = c.getContext("2d");
				
				var x = event.data.split(';')[0];
				var y = event.data.split(';')[1];
				
				//table stuff
				ctx.fillStyle="navajowhite";
				ctx.fillRect(0,0,dimensionX,dimensionY);
				ctx.fillStyle="green";
				ctx.fillRect((dimensionX-dimenstionTableX)/2,(dimensionY-dimenstionTableY)/2,dimenstionTableX,dimenstionTableY);
				ctx.fillStyle="black";
				ctx.fillRect((dimensionX-5)/2,(dimensionY-dimenstionTableY)/2,5,dimenstionTableY);
				
				//ball
				ctx.beginPath();
				ctx.arc(x,y,10,0,2*Math.PI);
				ctx.fillStyle="white";
				ctx.stroke();
				ctx.fill();
				
				//tail
				ctx.beginPath();
				ctx.moveTo(savedX,savedY);
				ctx.lineTo(x,y);
				ctx.strokeStyle="red";
				ctx.stroke();
				
				var a = savedX - x;
				if(a<0)
					a=a*-1;
				
				var b = savedY - y;
				if(b<0)
					b=b*-1;
					
				var distInCm = Math.sqrt((a*a)+(b*b)) / (dimenstionTableY/realDimensionTableY);
				//console.log(distInCm);

				//console.log(distInCm);
				
				var speedInCmS =  Math.round(distInCm / (intervalInMs/1000));
				//console.log(speedInCmS);
				
				document.getElementById("speedId").innerHTML=speedInCmS+" cm/s";
				
				savedX=x;
				savedY=y;
				

            };

        </script>
		
		
    </body>
</html>